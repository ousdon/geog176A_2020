<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Xingxin Li" />


<title>Lab2</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/simplex.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 41px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h2 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h3 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h4 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h5 {
  padding-top: 46px;
  margin-top: -46px;
}
.section h6 {
  padding-top: 46px;
  margin-top: -46px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My First Website</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="geog176A.html">
    <span class="fa fa-pencil-ruler"></span>
     
    Geography 176A Work
  </a>
</li>
<li>
  <a href="CV.html">
    <span class="fa fa-sticky-note"></span>
     
    CV
  </a>
</li>
<li>
  <a href="day-07.html">
    <span class="fa fa-accusoft"></span>
     
    day-07
  </a>
</li>
<li>
  <a href="day13.html">
    <span class="fa fa-accusoft"></span>
     
    day-13
  </a>
</li>
<li>
  <a href="lab2.html">
    <span class="fa fa-accusoft"></span>
     
    Lab2
  </a>
</li>
<li>
  <a href="lab3.html">
    <span class="fa fa-accusoft"></span>
     
    Lab3
  </a>
</li>
<li>
  <a href="lab-04.html">
    <span class="fa fa-accusoft"></span>
     
    Lab4
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ousdon/geog176a-lab1">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Lab2</h1>
<h4 class="author">Xingxin Li</h4>
<h4 class="date">8/17/2020</h4>

</div>


<pre class="r"><code>library(dplyr) 
library(ggplot2)
library(tidyverse)
library(zoo)
library(knitr)
library(readxl)

url = &#39;https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-counties.csv&#39;
read_csv(url)</code></pre>
<pre><code>## # A tibble: 482,727 x 6
##    date       county      state      fips  cases deaths
##    &lt;date&gt;     &lt;chr&gt;       &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;
##  1 2020-01-21 Snohomish   Washington 53061     1      0
##  2 2020-01-22 Snohomish   Washington 53061     1      0
##  3 2020-01-23 Snohomish   Washington 53061     1      0
##  4 2020-01-24 Cook        Illinois   17031     1      0
##  5 2020-01-24 Snohomish   Washington 53061     1      0
##  6 2020-01-25 Orange      California 06059     1      0
##  7 2020-01-25 Cook        Illinois   17031     1      0
##  8 2020-01-25 Snohomish   Washington 53061     1      0
##  9 2020-01-26 Maricopa    Arizona    04013     1      0
## 10 2020-01-26 Los Angeles California 06037     1      0
## # … with 482,717 more rows</code></pre>
<pre class="r"><code>source = &quot;/Users/xingxin/Github/geog176a-lab2/data/&quot;


covid&lt;-read_csv(url)
head(covid)</code></pre>
<pre><code>## # A tibble: 6 x 6
##   date       county    state      fips  cases deaths
##   &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;      &lt;chr&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 2020-01-21 Snohomish Washington 53061     1      0
## 2 2020-01-22 Snohomish Washington 53061     1      0
## 3 2020-01-23 Snohomish Washington 53061     1      0
## 4 2020-01-24 Cook      Illinois   17031     1      0
## 5 2020-01-24 Snohomish Washington 53061     1      0
## 6 2020-01-25 Orange    California 06059     1      0</code></pre>
<div id="question-1" class="section level1">
<h1>Question 1</h1>
<pre class="r"><code>#  California, the daily new cases
dat = covid %&gt;% 
  filter(state == &quot;California&quot;) %&gt;% 
  group_by(county) %&gt;% 
  mutate(newCases = c(NA, diff(cases))) %&gt;% 
  ungroup() %&gt;% 
  filter(date == max(date)) </code></pre>
<pre class="r"><code>#  the 5 counties with the most cumulative cases
most_cum_cases = dat %&gt;% 
  slice_max(cases, n = 5) %&gt;% 
  select(county, cases)

knitr::kable(most_cum_cases, 
             caption = &quot;Most Cumulative Cases California Counties&quot;,
             col.names = c(&quot;County&quot;, &quot;cumulative Cases&quot;))</code></pre>
<table>
<caption>Most Cumulative Cases California Counties</caption>
<thead>
<tr class="header">
<th align="left">County</th>
<th align="right">cumulative Cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Los Angeles</td>
<td align="right">239756</td>
</tr>
<tr class="even">
<td align="left">Riverside</td>
<td align="right">51860</td>
</tr>
<tr class="odd">
<td align="left">Orange</td>
<td align="right">48190</td>
</tr>
<tr class="even">
<td align="left">San Bernardino</td>
<td align="right">47145</td>
</tr>
<tr class="odd">
<td align="left">San Diego</td>
<td align="right">38110</td>
</tr>
</tbody>
</table>
<pre class="r"><code># the 5 counties with the most NEW cases
most_new_cases = dat %&gt;% 
  slice_max(newCases, n = 5) %&gt;% 
  select(county, newCases)

knitr::kable(most_new_cases, 
             caption = &quot;Most New Cases California Counties&quot;,
             col.names = c(&quot;County&quot;, &quot;New Cases&quot;))</code></pre>
<table>
<caption>Most New Cases California Counties</caption>
<thead>
<tr class="header">
<th align="left">County</th>
<th align="right">New Cases</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Los Angeles</td>
<td align="right">1298</td>
</tr>
<tr class="even">
<td align="left">Orange</td>
<td align="right">408</td>
</tr>
<tr class="odd">
<td align="left">San Diego</td>
<td align="right">263</td>
</tr>
<tr class="even">
<td align="left">San Bernardino</td>
<td align="right">253</td>
</tr>
<tr class="odd">
<td align="left">Fresno</td>
<td align="right">245</td>
</tr>
</tbody>
</table>
<pre class="r"><code># import population data
PopulationEstimates &lt;- read_excel(paste(source,&quot;PopulationEstimates.xls&quot;,sep = &quot;&quot;), 
                                  skip = 2)
population_2019 = PopulationEstimates %&gt;% 
  select(FIPStxt,POP_ESTIMATE_2019) 

# join the population data to the California COVID data.  
dat2 &lt;-inner_join(dat, population_2019, by = c(&quot;fips&quot; = &quot;FIPStxt&quot;))</code></pre>
<pre class="r"><code>#  the 5 counties with the most cumulative cases per capita
most_cum_cases_pc = dat2 %&gt;%
  mutate(Cases_pc = cases/POP_ESTIMATE_2019) %&gt;%
  slice_max(Cases_pc, n = 5) %&gt;% 
  select(county, Cases_pc)

knitr::kable(most_cum_cases_pc, 
             caption = &quot;Most Cumulative Cases California Counties Per Capita&quot;,
             col.names = c(&quot;County&quot;, &quot;cumulative Cases Per Capita&quot;))</code></pre>
<table>
<caption>Most Cumulative Cases California Counties Per Capita</caption>
<thead>
<tr class="header">
<th align="left">County</th>
<th align="right">cumulative Cases Per Capita</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Imperial</td>
<td align="right">0.0588638</td>
</tr>
<tr class="even">
<td align="left">Kings</td>
<td align="right">0.0401595</td>
</tr>
<tr class="odd">
<td align="left">Kern</td>
<td align="right">0.0323316</td>
</tr>
<tr class="even">
<td align="left">Tulare</td>
<td align="right">0.0297815</td>
</tr>
<tr class="odd">
<td align="left">Merced</td>
<td align="right">0.0284140</td>
</tr>
</tbody>
</table>
<pre class="r"><code># the 5 counties with the most NEW cases per capita
most_new_cases_pc = dat2 %&gt;% 
  mutate(newCases_pc = newCases/POP_ESTIMATE_2019) %&gt;%
  slice_max(newCases_pc, n = 5) %&gt;% 
  select(county, newCases_pc)

knitr::kable(most_new_cases_pc, 
             caption = &quot;Most New Cases California Counties Per Capit&quot;,
             col.names = c(&quot;County&quot;, &quot;New Cases Per Capit&quot;))</code></pre>
<table>
<caption>Most New Cases California Counties Per Capit</caption>
<thead>
<tr class="header">
<th align="left">County</th>
<th align="right">New Cases Per Capit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">San Benito</td>
<td align="right">0.0006209</td>
</tr>
<tr class="even">
<td align="left">Stanislaus</td>
<td align="right">0.0004086</td>
</tr>
<tr class="odd">
<td align="left">Kings</td>
<td align="right">0.0002550</td>
</tr>
<tr class="even">
<td align="left">Fresno</td>
<td align="right">0.0002452</td>
</tr>
<tr class="odd">
<td align="left">Marin</td>
<td align="right">0.0001932</td>
</tr>
</tbody>
</table>
<pre class="r"><code># 14-days 
per_cap = covid %&gt;% 
  filter(state == &quot;California&quot;) %&gt;% 
  group_by(county) %&gt;% 
  mutate(newCases = c(NA, diff(cases))) %&gt;% 
  ungroup() %&gt;%
  filter(date &gt;= max(date)-13)  %&gt;%
  inner_join(population_2019, by = c(&quot;fips&quot; = &quot;FIPStxt&quot;))

#Calculate Safe counties
dat_14 = per_cap %&gt;%
  group_by(county,POP_ESTIMATE_2019) %&gt;%
  summarize(tot_newCases = sum(newCases, na.rm = TRUE),tot_cumCases = sum(cases, na.rm = TRUE)) %&gt;%  
  ungroup() %&gt;%
  mutate(tot_safe_county = tot_newCases/(POP_ESTIMATE_2019/100000)) %&gt;% 
  filter(tot_safe_county &lt; 100)</code></pre>
<div id="results-of-california" class="section level3">
<h3>Results of California</h3>
<ol style="list-style-type: decimal">
<li><p>the total number of cases: 7.0249910^{5}</p></li>
<li><p>the total number of new cases: 4110</p></li>
<li><p>the total number of the total number of safe counties : 18</p></li>
</ol>
<p># Question 2</p>
<pre class="r"><code># facet plot of the daily new cases and the 7-day rolling mean
# select four states
four_states &lt;- covid %&gt;%
  filter(state %in% c(&quot;New York&quot;,&quot;California&quot;, &quot;Louisiana&quot;, &quot;Florida&quot;)) %&gt;%
  group_by(state, date) %&gt;%
  summarize(cases = sum(cases)) %&gt;% 
  ungroup() %&gt;% 
  group_by(state) %&gt;% 
  mutate(newCases = cases - lag(cases),
         roll7 = rollmean(newCases, 7, fill = NA, align = &#39;right&#39;)) %&gt;%
  ungroup() %&gt;%
  filter(newCases &gt; 0)

  ggplot(data = four_states,aes(x = date)) +
  geom_col(aes(y = newCases), col = NA, fill = &quot;#F5B8B5&quot;) +  
  geom_line(aes(y = roll7), col = &quot;darkred&quot;, size = 1) +  
  labs(x = &quot;Date&quot;, y = &quot;Daily New Cases&quot;,
       title = &quot;New Reported Cases By Day &quot;) +
  theme(plot.background = element_rect(fill = &quot;white&quot;),  
        panel.background = element_rect(fill = &quot;white&quot;),  
        plot.title = element_text(size = 14, face = &#39;bold&#39;)) +  
  facet_grid(~state, scales = &quot;free_y&quot;)</code></pre>
<p><img src="lab2_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<pre class="r"><code># import population data
PopulationEstimates &lt;- read_excel(paste(source,&quot;PopulationEstimates.xls&quot;,sep = &quot;&quot;), 
                                  skip = 2)
population_2019 = PopulationEstimates %&gt;% 
  select(Area_Name,POP_ESTIMATE_2019) </code></pre>
<pre class="r"><code># facet plot of the daily new cases and the 7-day rolling mean
# select four states per capita
four_states_pc &lt;- population_2019 %&gt;%
  right_join(four_states, by = c(&quot;Area_Name&quot; = &quot;state&quot;)) %&gt;%
  mutate(newCases_pc = (newCases/POP_ESTIMATE_2019), 
         roll7 = rollmean(newCases_pc, 7, fill = NA, align = &#39;right&#39;)) %&gt;%
  ungroup() %&gt;%
  filter(newCases_pc &gt; 0)

  ggplot(data = four_states_pc,aes(x = date)) +
  geom_col(aes(y = newCases_pc), col = NA, fill = &quot;skyblue&quot;) +  
  geom_line(aes(y = roll7), col = &quot;darkblue&quot;, size = 1) +  
  labs(x = &quot;Date&quot;, y = &quot;Daily New Cases Per Capita&quot;,
       title = &quot;New Reported Cases Per Capita By Day &quot;) +
  theme(plot.background = element_rect(fill = &quot;white&quot;),  
        panel.background = element_rect(fill = &quot;white&quot;),  
        plot.title = element_text(size = 14, face = &#39;bold&#39;)) +  
  facet_grid(~Area_Name, scales = &quot;free_y&quot;) </code></pre>
<p><img src="lab2_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>The absolute value of new cases in Louisiana is much lower than the other three states. However, the new cases per capita in Louisiana is close to the other states. The possible reason is that Louisiana has a much smaller populaition compared with other states.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
